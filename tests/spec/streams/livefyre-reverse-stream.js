define([
    'streamhub-sdk/jquery',
    'jasmine',
    'streamhub-sdk/streams/livefyre-reverse-stream',
    'streamhub-sdk/clients/livefyre-bootstrap-client',
    'jasmine-jquery'],
function ($, jasmine, LivefyreReverseStream, LivefyreBootstrapClient) {
    describe('A LivefyreReverseStream', function () {
        var stream, opts, spy, mockData, mockInitResponse;

        beforeEach(function () {
            mockData = {"content": [{"source": 5, "content": {"replaces": "", "parentId": "", "bodyHtml": "<p>Kaepernick takes off running for a 49ers touchdown!</p><em>{\"eventType\":\"sanfran\",\"eventImportant\":false,\"_\":1360283811818}</em>", "id": "26382469", "authorId": "system@labs-t402.fyre.co", "updatedAt": 1360283812, "annotations": {"moderator": true}, "createdAt": 1360283812}, "vis": 1, "type": 0, "event": 1360283813031663, "childContent": []}, {"source": 5, "content": {"replaces": "", "parentId": "", "bodyHtml": "<p></p><em>{\"eventType\":\"sf-touchdown\",\"eventImportant\":true,\"_\":1360283792121}</em>", "id": "26382468", "authorId": "system@labs-t402.fyre.co", "updatedAt": 1360283793, "annotations": {"moderator": true}, "createdAt": 1360283793}, "vis": 1, "type": 0, "event": 1360283793258498, "childContent": []}, {"source": 5, "content": {"replaces": "", "parentId": "", "bodyHtml": "<p>After the flag the Ravens take over with a 1st and 10 on their own 49\n</p><em>{\"eventType\":\"baltimore\",\"eventImportant\":false,\"_\":1360283730626}</em>", "id": "26382467", "authorId": "system@labs-t402.fyre.co", "updatedAt": 1360283731, "annotations": {"moderator": true}, "createdAt": 1360283731}, "vis": 1, "type": 0, "event": 1360283731873821, "childContent": []}, {"source": 5, "content": {"replaces": "", "parentId": "", "bodyHtml": "<p>Unsportsmanlike Conduct - #55 on the 49ers</p><em>{\"eventType\":\"sanfran\",\"eventImportant\":false,\"_\":1360283711045}</em>", "id": "26382466", "authorId": "system@labs-t402.fyre.co", "updatedAt": 1360283712, "annotations": {"moderator": true}, "createdAt": 1360283712}, "vis": 1, "type": 0, "event": 1360283712170340, "childContent": []}, {"source": 5, "content": {"replaces": "", "parentId": "", "bodyHtml": "<p></p><em>{\"eventType\":\"flag\",\"eventImportant\":true,\"_\":1360283695750}</em>", "id": "26382465", "authorId": "system@labs-t402.fyre.co", "updatedAt": 1360283697, "annotations": {"moderator": true}, "createdAt": 1360283696}, "vis": 1, "type": 0, "event": 1360283697743105, "childContent": []}, {"source": 5, "content": {"replaces": "", "parentId": "", "bodyHtml": "<p>After the TV timeout, the Ravens run the ball to the side for a sort gain \n</p><em>{\"eventType\":\"baltimore\",\"eventImportant\":false,\"_\":1360283687345}</em>", "id": "26382464", "authorId": "system@labs-t402.fyre.co", "updatedAt": 1360283688, "annotations": {"moderator": true}, "createdAt": 1360283688}, "vis": 1, "type": 0, "event": 1360283688478341, "childContent": []}, {"source": 5, "content": {"replaces": "", "parentId": "", "bodyHtml": "<p>FyrePoll: Who Wins Super Bowl 47? Vote now <a href=\"http://bit.ly/11p5Dpg\" target=\"_blank\" rel=\"nofollow\">http://bit.ly/11p5Dpg</a></p><em>{\"eventType\":\"blank\",\"eventImportant\":false,\"_\":1360283664418}</em>", "id": "26382463", "authorId": "system@labs-t402.fyre.co", "updatedAt": 1360283665, "annotations": {"moderator": true}, "createdAt": 1360283665}, "vis": 1, "type": 0, "event": 1360283665584310, "childContent": []}, {"source": 5, "content": {"replaces": "", "parentId": "", "bodyHtml": "<p></p><em>{\"eventType\":\"twominute\",\"eventImportant\":true,\"_\":1360283652091}</em>", "id": "26382462", "authorId": "system@labs-t402.fyre.co", "updatedAt": 1360283653, "annotations": {"moderator": true}, "createdAt": 1360283653}, "vis": 1, "type": 0, "event": 1360283653213877, "childContent": []}, {"source": 5, "content": {"replaces": "", "parentId": "", "bodyHtml": "<p>Flacco snaps the ball just before the two minute mark, incomplete to Boldin\n</p><em>{\"eventType\":\"baltimore\",\"eventImportant\":false,\"_\":1360283649028}</em>", "id": "26382461", "authorId": "system@labs-t402.fyre.co", "updatedAt": 1360283650, "annotations": {"moderator": true}, "createdAt": 1360283650}, "vis": 1, "type": 0, "event": 1360283650143458, "childContent": []}, {"source": 5, "content": {"replaces": "", "parentId": "", "bodyHtml": "<p>Rice takes the kick at the 1 yard line and returns to about the 20 for a gain of 19. </p><em>{\"eventType\":\"baltimore\",\"eventImportant\":false,\"_\":1360283624465}</em>", "id": "26382460", "authorId": "system@labs-t402.fyre.co", "updatedAt": 1360283625, "annotations": {"moderator": true}, "createdAt": 1360283625}, "vis": 1, "type": 0, "event": 1360283625622513, "childContent": []}, {"source": 5, "content": {"replaces": "", "parentId": "", "bodyHtml": "<p></p><em>{\"eventType\":\"kickoff\",\"eventImportant\":true,\"_\":1360283602725}</em>", "id": "26382459", "authorId": "system@labs-t402.fyre.co", "updatedAt": 1360283603, "annotations": {"moderator": true}, "createdAt": 1360283603}, "vis": 1, "type": 0, "event": 1360283603879091, "childContent": []}, {"source": 5, "content": {"replaces": "", "parentId": "", "bodyHtml": "<p>The officials rule that Kaepernick was in play when he scored, touchdown stands!\n</p><em>{\"eventType\":\"sanfran\",\"eventImportant\":false,\"_\":1360283596502}</em>", "id": "26382458", "authorId": "system@labs-t402.fyre.co", "updatedAt": 1360283597, "annotations": {"moderator": true}, "createdAt": 1360283597}, "vis": 1, "type": 0, "event": 1360283597809269, "childContent": []}, {"source": 5, "content": {"replaces": "", "parentId": "", "bodyHtml": "<p></p><em>{\"eventType\":\"challenge\",\"eventImportant\":true,\"_\":1360283560457}</em>", "id": "26382456", "authorId": "system@labs-t402.fyre.co", "updatedAt": 1360283561, "annotations": {"moderator": true}, "createdAt": 1360283561}, "vis": 1, "type": 0, "event": 1360283561612753, "childContent": []}, {"source": 5, "content": {"replaces": "", "parentId": "", "bodyHtml": "<p>That play caps off a 55 yard drive by the niners...but first the ravens challenge the play</p><em>{\"eventType\":\"sanfran\",\"eventImportant\":false,\"_\":1360283558163}</em>", "id": "26382455", "authorId": "system@labs-t402.fyre.co", "updatedAt": 1360283559, "annotations": {"moderator": true}, "createdAt": 1360283559}, "vis": 1, "type": 0, "event": 1360283559299046, "childContent": []}, {"source": 5, "content": {"replaces": "", "parentId": "", "bodyHtml": "<p>Kaepernick takes off running for a 49ers touchdown</p><em>{\"eventType\":\"sanfran\",\"eventImportant\":false,\"_\":1360283529439}</em>", "id": "26382454", "authorId": "system@labs-t402.fyre.co", "updatedAt": 1360283530, "annotations": {"moderator": true}, "createdAt": 1360283530}, "vis": 1, "type": 0, "event": 1360283530718884, "childContent": []}, {"source": 5, "content": {"replaces": "", "parentId": "", "bodyHtml": "<p></p><em>{\"eventType\":\"sf-touchdown\",\"eventImportant\":true,\"_\":1360283517401}</em>", "id": "26382453", "authorId": "system@labs-t402.fyre.co", "updatedAt": 1360283518, "annotations": {"moderator": true}, "createdAt": 1360283518}, "vis": 1, "type": 0, "event": 1360283518644273, "childContent": []}, {"source": 5, "content": {"replaces": "", "parentId": "", "bodyHtml": "<p>This Super Bowl NewsHub is powered by Livefyre StreamHub <a href=\"http://bit.ly/11rEphW\" target=\"_blank\" rel=\"nofollow\">http://bit.ly/11rEphW</a></p><em>{\"eventType\":\"blank\",\"eventImportant\":false,\"_\":1360283491823}</em>", "id": "26382452", "authorId": "system@labs-t402.fyre.co", "updatedAt": 1360283493, "annotations": {"moderator": true}, "createdAt": 1360283493}, "vis": 1, "type": 0, "event": 1360283493871823, "childContent": []}, {"source": 5, "content": {"replaces": "", "parentId": "", "bodyHtml": "<p>#SB47</p><em>{\"eventType\":\"sanfran\",\"eventImportant\":false,\"_\":1360283387131}</em>", "id": "26382451", "authorId": "system@labs-t402.fyre.co", "updatedAt": 1360283389, "annotations": {"moderator": true}, "createdAt": 1360283388}, "vis": 1, "type": 0, "event": 1360283390872792, "childContent": []}, {"source": 5, "content": {"replaces": "", "parentId": "", "bodyHtml": "<p>FyreFacts: John Elway of the Denver Broncos was the first quarterback to start five Super Bowls</p><em>{\"eventType\":\"blank\",\"eventImportant\":false,\"_\":1360004219205}</em>", "id": "26379160", "authorId": "system@labs-t402.fyre.co", "updatedAt": 1360004218, "annotations": {"moderator": true}, "createdAt": 1360004218}, "vis": 1, "type": 0, "event": 1360004218721974, "childContent": []}, {"source": 5, "content": {"replaces": "", "parentId": "", "bodyHtml": "<p>FyreFacts: The price of a 30-second commercial for Super Bowl I in 1967 was $42,000</p><em>{\"eventType\":\"blank\",\"eventImportant\":false,\"_\":1360004181283}</em>", "id": "26379159", "authorId": "system@labs-t402.fyre.co", "updatedAt": 1360004181, "annotations": {"moderator": true}, "createdAt": 1360004180}, "vis": 1, "type": 0, "event": 1360004181160258, "childContent": []}, {"source": 5, "content": {"replaces": "", "parentId": "", "bodyHtml": "<p></p><em>{\"eventType\":\"kickoff\",\"eventImportant\":true,\"_\":1359868084083}</em>", "id": "26379057", "authorId": "system@labs-t402.fyre.co", "updatedAt": 1359868084, "annotations": {"moderator": true}, "createdAt": 1359868084}, "vis": 1, "type": 0, "event": 1359868084848703, "childContent": []}, {"source": 5, "content": {"replaces": "", "parentId": "", "bodyHtml": "<p></p><em>{\"eventType\":\"firstdown\",\"eventImportant\":true,\"_\":1359867734011}</em>", "id": "26379056", "authorId": "system@labs-t402.fyre.co", "updatedAt": 1359867734, "annotations": {"moderator": true}, "createdAt": 1359867734}, "vis": 1, "type": 0, "event": 1359867734564738, "childContent": []}, {"source": 5, "content": {"replaces": "", "parentId": "", "bodyHtml": "<p></p><em>{\"eventType\":\"challenge\",\"eventImportant\":true,\"_\":1359867728519}</em>", "id": "26379055", "authorId": "system@labs-t402.fyre.co", "updatedAt": 1359867729, "annotations": {"moderator": true}, "createdAt": 1359867728}, "vis": 1, "type": 0, "event": 1359867729038217, "childContent": []}, {"source": 5, "content": {"replaces": "", "parentId": "", "bodyHtml": "<p></p><em>{\"eventType\":\"flag\",\"eventImportant\":true,\"_\":1359867721033}</em>", "id": "26379054", "authorId": "system@labs-t402.fyre.co", "updatedAt": 1359867721, "annotations": {"moderator": true}, "createdAt": 1359867721}, "vis": 1, "type": 0, "event": 1359867721847343, "childContent": []}, {"source": 5, "content": {"replaces": "", "parentId": "", "bodyHtml": "<p>msgLengthCountdow nms gLengthCountdownmsgLengthCount downmsgLengthCountdownms gLengthCountdown asdff</p><em>{\"eventType\":\"blank\",\"eventImportant\":false,\"_\":1359866293712}</em>", "id": "26379053", "authorId": "system@labs-t402.fyre.co", "updatedAt": 1359866294, "annotations": {"moderator": true}, "createdAt": 1359866294}, "vis": 1, "type": 0, "event": 1359866294560252, "childContent": []}, {"source": 5, "content": {"replaces": "", "parentId": "", "bodyHtml": "<p>1234567890123456789012345678901 1234567890123456789012345678901 1234567890123456789012345678901</p><em>{\"eventType\":\"blank\",\"eventImportant\":true,\"_\":1359865962973}</em>", "id": "26379052", "authorId": "system@labs-t402.fyre.co", "updatedAt": 1359865963, "annotations": {"moderator": true}, "createdAt": 1359865963}, "vis": 1, "type": 0, "event": 1359865963599420, "childContent": []}, {"source": 5, "content": {"replaces": "", "parentId": "", "bodyHtml": "<p>123456789012345678901234567890</p><em>{\"eventType\":\"blank\",\"eventImportant\":true,\"_\":1359865937150}</em>", "id": "26379051", "authorId": "system@labs-t402.fyre.co", "updatedAt": 1359865937, "annotations": {"moderator": true}, "createdAt": 1359865937}, "vis": 1, "type": 0, "event": 1359865937818290, "childContent": []}, {"source": 5, "content": {"replaces": "", "parentId": "", "bodyHtml": "<p>123456789012345678901234567890 123456789012345678901234567890 123456789012345678901234567890</p><em>{\"eventType\":\"blank\",\"eventImportant\":true,\"_\":1359865930566}</em>", "id": "26379050", "authorId": "system@labs-t402.fyre.co", "updatedAt": 1359865931, "annotations": {"moderator": true}, "createdAt": 1359865931}, "vis": 1, "type": 0, "event": 1359865931235842, "childContent": []}, {"source": 5, "content": {"replaces": "", "parentId": "", "bodyHtml": "<p>1234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890</p><em>{\"eventType\":\"blank\",\"eventImportant\":true,\"_\":1359865870373}</em>", "id": "26379049", "authorId": "system@labs-t402.fyre.co", "updatedAt": 1359865871, "annotations": {"moderator": true}, "createdAt": 1359865871}, "vis": 1, "type": 0, "event": 1359865871175368, "childContent": []}, {"source": 5, "content": {"replaces": "", "parentId": "", "bodyHtml": "<p>oops timeline message</p><em>{\"eventType\":\"blank\",\"eventImportant\":true,\"_\":1359865634554}</em>", "id": "26379048", "authorId": "system@labs-t402.fyre.co", "updatedAt": 1359865635, "annotations": {"moderator": true}, "createdAt": 1359865635}, "vis": 1, "type": 0, "event": 1359865635157270, "childContent": []}, {"source": 5, "content": {"replaces": "", "parentId": "", "bodyHtml": "<p>timeline message</p><em>{\"eventType\":\"blank\",\"eventImportant\":false,\"_\":1359865625680}</em>", "id": "26379047", "authorId": "system@labs-t402.fyre.co", "updatedAt": 1359865626, "annotations": {"moderator": true}, "createdAt": 1359865626}, "vis": 1, "type": 0, "event": 1359865626292293, "childContent": []}, {"source": 5, "content": {"replaces": "", "parentId": "", "bodyHtml": "<p>normal message</p><em>{\"eventType\":\"blank\",\"eventImportant\":false,\"_\":1359865619398}</em>", "id": "26379046", "authorId": "system@labs-t402.fyre.co", "updatedAt": 1359865620, "annotations": {"moderator": true}, "createdAt": 1359865620}, "vis": 1, "type": 0, "event": 1359865620431319, "childContent": []}, {"source": 5, "content": {"replaces": "", "parentId": "", "bodyHtml": "<p></p><em>{\"eventType\":\"halftime\",\"eventImportant\":true,\"_\":1359855093214}</em>", "id": "26379045", "authorId": "system@labs-t402.fyre.co", "updatedAt": 1359855094, "annotations": {"moderator": true}, "createdAt": 1359855094}, "vis": 1, "type": 0, "event": 1359855094182774, "childContent": []}, {"source": 5, "content": {"replaces": "", "parentId": "", "bodyHtml": "<p>test</p><em>{\"eventType\":\"baltimore\",\"eventImportant\":false,\"_\":1359855089873}</em>", "id": "26379044", "authorId": "system@labs-t402.fyre.co", "updatedAt": 1359855090, "annotations": {"moderator": true}, "createdAt": 1359855090}, "vis": 1, "type": 0, "event": 1359855090817284, "childContent": []}, {"source": 5, "content": {"replaces": "", "parentId": "", "bodyHtml": "<p></p><em>{\"eventType\":\"endof2nd\",\"eventImportant\":true,\"_\":1359855084029}</em>", "id": "26379043", "authorId": "system@labs-t402.fyre.co", "updatedAt": 1359855084, "annotations": {"moderator": true}, "createdAt": 1359855084}, "vis": 1, "type": 0, "event": 1359855084974334, "childContent": []}, {"source": 5, "content": {"replaces": "", "parentId": "", "bodyHtml": "<p></p><em>{\"eventType\":\"sf-touchdown\",\"eventImportant\":true,\"_\":1359855081117}</em>", "id": "26379042", "authorId": "system@labs-t402.fyre.co", "updatedAt": 1359855082, "annotations": {"moderator": true}, "createdAt": 1359855081}, "vis": 1, "type": 0, "event": 1359855082056004, "childContent": []}, {"source": 5, "content": {"replaces": "", "parentId": "", "bodyHtml": "<p>test</p><em>{\"eventUrl\":\"<a href=\"http://nickcicero.files.wordpress.com/2013/02/screen-shot-2013-02-02-at-5-11-37-pm.png\" target=\"_blank\" rel=\"nofollow\">http://nickcicero.files.wordpress.com/2013/02/screen-shot-2013-02-02-at-5-11-37-pm.png</a>\",\"eventImportant\":false,\"_\":1359855028070}</em>", "id": "26379041", "authorId": "system@labs-t402.fyre.co", "updatedAt": 1359855029, "annotations": {"moderator": true}, "createdAt": 1359855028}, "vis": 1, "type": 0, "event": 1359855029035825, "childContent": []}, {"source": 5, "content": {"replaces": "", "parentId": "", "bodyHtml": "<p>FyrePoll: Brats or Pizza? Vote now <a href=\"http://bit.ly/11rpZhO\" target=\"_blank\" rel=\"nofollow\">http://bit.ly/11rpZhO</a> </p><em>{\"eventUrl\":\"<a href=\"http://nickcicero.files.wordpress.com/2013/02/screen-shot-2013-02-02-at-5-11-37-pm.png\" target=\"_blank\" rel=\"nofollow\">http://nickcicero.files.wordpress.com/2013/02/screen-shot-2013-02-02-at-5-11-37-pm.png</a>\",\"eventImportant\":false,\"_\":1359855017619}</em>", "id": "26379040", "authorId": "system@labs-t402.fyre.co", "updatedAt": 1359855018, "annotations": {"moderator": true}, "createdAt": 1359855018}, "vis": 1, "type": 0, "event": 1359855018589509, "childContent": []}, {"source": 5, "content": {"replaces": "", "parentId": "", "bodyHtml": "<p>FyrePoll: Brats or Pizza? Vote now <a href=\"http://bit.ly/11rpZhO\" target=\"_blank\" rel=\"nofollow\">http://bit.ly/11rpZhO</a> </p><em>{\"eventUrl\":\"<a href=\"http://nickcicero.files.wordpress.com/2013/02/screen-shot-2013-02-02-at-5-11-37-pm.png\" target=\"_blank\" rel=\"nofollow\">http://nickcicero.files.wordpress.com/2013/02/screen-shot-2013-02-02-at-5-11-37-pm.png</a>\",\"eventImportant\":false,\"_\":1359854996050}</em>", "id": "26379039", "authorId": "system@labs-t402.fyre.co", "updatedAt": 1359854997, "annotations": {"moderator": true}, "createdAt": 1359854997}, "vis": 1, "type": 0, "event": 1359854997295938, "childContent": []}, {"source": 5, "content": {"replaces": "", "parentId": "", "bodyHtml": "<p></p><em>{\"eventType\":\"bal-touchdown\",\"eventImportant\":true,\"_\":1359853883148}</em>", "id": "26379038", "authorId": "system@labs-t402.fyre.co", "updatedAt": 1359853883, "annotations": {"moderator": true}, "createdAt": 1359853883}, "vis": 1, "type": 0, "event": 1359853883375745, "childContent": []}, {"source": 5, "content": {"replaces": "", "parentId": "", "bodyHtml": "<p></p><em>{\"eventType\":\"sf-touchdown\",\"eventImportant\":true,\"_\":1359853864535}</em>", "id": "26379037", "authorId": "system@labs-t402.fyre.co", "updatedAt": 1359853864, "annotations": {"moderator": true}, "createdAt": 1359853864}, "vis": 1, "type": 0, "event": 1359853864929734, "childContent": []}, {"source": 5, "content": {"replaces": "", "parentId": "", "bodyHtml": "<p>Niners giving Flacco no looks in the endzone. He gets taken down for the 6th time today.</p><em>{\"eventType\":\"sanfran\",\"eventImportant\":false,\"_\":1359853738997}</em>", "id": "26379036", "authorId": "user_0@labs-t402.fyre.co", "updatedAt": 1359853739, "annotations": {"whitelist": true}, "createdAt": 1359853739}, "vis": 1, "type": 0, "event": 1359853739479500, "childContent": []}, {"source": 5, "content": {"replaces": "", "parentId": "", "bodyHtml": "<p>Big pass to Pitta - 1st and goal ravens</p><em>{\"eventType\":\"baltimore\",\"eventImportant\":false,\"_\":1359853682914}</em>", "id": "26379035", "authorId": "system@labs-t402.fyre.co", "updatedAt": 1359853683, "annotations": {"moderator": true}, "createdAt": 1359853683}, "vis": 1, "type": 0, "event": 1359853683116120, "childContent": []}, {"source": 5, "content": {"replaces": "", "parentId": "", "bodyHtml": "<p>FyrePoll: Wings or Nachos? Vote now <a href=\"http://bit.ly/WGsHRf\" target=\"_blank\" rel=\"nofollow\">http://bit.ly/WGsHRf</a></p><em>{\"eventUrl\":\"<a href=\"http://www.ledr.com/colours/black.jpg\" target=\"_blank\" rel=\"nofollow\">http://www.ledr.com/colours/black.jpg</a>\",\"eventImportant\":false,\"_\":1359853661090}</em>", "id": "26379034", "authorId": "system@labs-t402.fyre.co", "updatedAt": 1359853661, "annotations": {"moderator": true}, "createdAt": 1359853661}, "vis": 1, "type": 0, "event": 1359853661312270, "childContent": []}, {"source": 5, "content": {"replaces": "", "parentId": "", "bodyHtml": "<p></p><em>{\"eventType\":\"twominute\",\"eventImportant\":true,\"_\":1359853641893}</em>", "id": "26379033", "authorId": "system@labs-t402.fyre.co", "updatedAt": 1359853642, "annotations": {"moderator": true}, "createdAt": 1359853641}, "vis": 1, "type": 0, "event": 1359853642108195, "childContent": []}, {"source": 5, "content": {"replaces": "", "parentId": "", "bodyHtml": "<p>Livefyre: We Make Your Site Social sales@livefyre.com to learn more</p><em>{\"eventUrl\":\"<a href=\"http://www.ledr.com/colours/black.jpg\" target=\"_blank\" rel=\"nofollow\">http://www.ledr.com/colours/black.jpg</a>\",\"eventImportant\":false,\"_\":1359853636004}</em>", "id": "26379032", "authorId": "system@labs-t402.fyre.co", "updatedAt": 1359853636, "annotations": {"moderator": true}, "createdAt": 1359853636}, "vis": 1, "type": 0, "event": 1359853636192936, "childContent": []}, {"source": 5, "content": {"replaces": "", "parentId": "", "bodyHtml": "<p>The Ravens throwing game has been out of sync all day. That looked a bit better.</p><em>{\"eventType\":\"baltimore\",\"eventImportant\":false,\"_\":1359853620304}</em>", "id": "26379031", "authorId": "user_0@labs-t402.fyre.co", "updatedAt": 1359853620, "annotations": {"whitelist": true}, "createdAt": 1359853620}, "vis": 1, "type": 0, "event": 1359853620639667, "childContent": []}, {"source": 5, "content": {"replaces": "", "parentId": "", "bodyHtml": "<p>Big reception by torrey smith - 1st and 10 on the 35 yard line</p><em>{\"eventType\":\"baltimore\",\"eventImportant\":false,\"_\":1359853608369}</em>", "id": "26379030", "authorId": "system@labs-t402.fyre.co", "updatedAt": 1359853608, "annotations": {"moderator": true}, "createdAt": 1359853608}, "vis": 1, "type": 0, "event": 1359853608605367, "childContent": []}], "meta": {"last": 1360283812, "idx": 4, "first": 1359853608}, "authors": {"user_0@labs-t402.fyre.co": {"displayName": "User 0", "tags": [], "sourceId": "", "profileUrl": "", "avatar": "http://d10g4z0y9q0fip.cloudfront.net/a/anon/50.jpg", "type": 1, "id": "user_0@labs-t402.fyre.co"}, "system@labs-t402.fyre.co": {"displayName": "system", "tags": [], "sourceId": "", "profileUrl": "", "avatar": "http://gravatar.com/avatar/e23293c6dfc25b86762b045336233add/?s=50&d=http://d10g4z0y9q0fip.cloudfront.net/a/anon/50.jpg", "type": 1, "id": "system@labs-t402.fyre.co"}}};
            mockInitResponse = {"headDocument": {"content": [{"source": 5, "content": {"parentId": "", "bodyHtml": "<p>1 1372807378348</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "updatedAt": 1372807378, "id": "26447946", "createdAt": 1372807378}, "vis": 1, "type": 0, "event": 1372807378824134, "childContent": []}, {"source": 5, "content": {"parentId": "", "bodyHtml": "<p>0 1372781403976</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "updatedAt": 1372781405, "id": "26447867", "createdAt": 1372781405}, "vis": 1, "type": 0, "event": 1372781405765515, "childContent": [{"source": 5, "content": {"parentId": "26447867", "bodyHtml": "<p>again</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "createdAt": 1372782591, "updatedAt": 1372782591, "id": "26447872", "ancestorId": "26447867"}, "vis": 1, "type": 0, "event": 1372782591730685, "childContent": []}, {"source": 5, "content": {"parentId": "26447867", "bodyHtml": "<p>hi</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "createdAt": 1372781991, "updatedAt": 1372781991, "id": "26447871", "ancestorId": "26447867"}, "vis": 1, "type": 0, "event": 1372781991509027, "childContent": []}]}, {"source": 5, "content": {"parentId": "", "bodyHtml": "<p>3 1372778487471</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "updatedAt": 1372778486, "id": "26447864", "createdAt": 1372778486}, "vis": 1, "type": 0, "event": 1372778486863027, "childContent": []}, {"source": 5, "content": {"parentId": "", "bodyHtml": "<p>2 1372778058698</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "updatedAt": 1372778057, "id": "26447862", "createdAt": 1372778057}, "vis": 1, "type": 0, "event": 1372778057942193, "childContent": []}, {"source": 5, "content": {"parentId": "", "bodyHtml": "<p>4 1372778026533</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "updatedAt": 1372778026, "id": "26447861", "createdAt": 1372778025}, "vis": 1, "type": 0, "event": 1372778026865713, "childContent": [{"source": 5, "content": {"parentId": "26447861", "bodyHtml": "<p>What</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "createdAt": 1372778435, "updatedAt": 1372778435, "id": "26447863", "ancestorId": "26447861"}, "vis": 1, "type": 0, "event": 1372778435650837, "childContent": []}]}, {"source": 5, "content": {"parentId": "", "bodyHtml": "<p>as</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "updatedAt": 1372777904, "id": "26447860", "createdAt": 1372777904}, "vis": 1, "type": 0, "event": 1372777904407292, "childContent": []}, {"source": 5, "content": {"parentId": "", "bodyHtml": "<p>asd</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "updatedAt": 1372777857, "id": "26447859", "createdAt": 1372777857}, "vis": 1, "type": 0, "event": 1372777857769119, "childContent": []}, {"source": 5, "content": {"parentId": "", "bodyHtml": "<p>3 1372704030798</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "updatedAt": 1372704031, "id": "26447748", "createdAt": 1372704030}, "vis": 1, "type": 0, "event": 1372704031892325, "childContent": [{"source": 5, "content": {"parentId": "26447748", "bodyHtml": "<p>Oh hello there!</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "createdAt": 1372785029, "updatedAt": 1372785030, "id": "26447882", "ancestorId": "26447748"}, "vis": 1, "type": 0, "event": 1372785030228859, "childContent": []}, {"source": 5, "content": {"parentId": "26447748", "bodyHtml": "<p>wow</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "createdAt": 1372714512, "updatedAt": 1372714512, "id": "26447785", "ancestorId": "26447748"}, "vis": 1, "type": 0, "event": 1372714512644579, "childContent": []}, {"source": 5, "content": {"parentId": "26447748", "bodyHtml": "<p>boy that was insightful</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "createdAt": 1372713133, "updatedAt": 1372713134, "id": "26447776", "ancestorId": "26447748"}, "vis": 1, "type": 0, "event": 1372713134175552, "childContent": []}, {"source": 5, "content": {"parentId": "26447748", "bodyHtml": "<p>jukhjh</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "createdAt": 1372712859, "updatedAt": 1372712859, "id": "26447774", "ancestorId": "26447748"}, "vis": 1, "type": 0, "event": 1372712860128520, "childContent": []}, {"source": 5, "content": {"parentId": "26447748", "bodyHtml": "<p>asdf</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "createdAt": 1372704033, "updatedAt": 1372704033, "id": "26447749", "ancestorId": "26447748"}, "vis": 1, "type": 0, "event": 1372704034267233, "childContent": []}]}, {"source": 5, "content": {"parentId": "", "bodyHtml": "<p>1 1372703334982</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "updatedAt": 1372703335, "id": "26447746", "createdAt": 1372703335}, "vis": 1, "type": 0, "event": 1372703336111790, "childContent": [{"source": 5, "content": {"parentId": "26447746", "bodyHtml": "<p>and one more?</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "createdAt": 1372789001, "updatedAt": 1372789001, "id": "26447896", "ancestorId": "26447746"}, "vis": 1, "type": 0, "event": 1372789001596891, "childContent": []}, {"source": 5, "content": {"parentId": "26447746", "bodyHtml": "<p>nm</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "createdAt": 1372713924, "updatedAt": 1372713924, "id": "26447784", "ancestorId": "26447746"}, "vis": 1, "type": 0, "event": 1372713924495484, "childContent": []}, {"source": 5, "content": {"parentId": "26447746", "bodyHtml": "<p>help me pls</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "createdAt": 1372712117, "updatedAt": 1372712117, "id": "26447772", "ancestorId": "26447746"}, "vis": 1, "type": 0, "event": 1372712117995803, "childContent": []}, {"source": 5, "content": {"parentId": "26447746", "bodyHtml": "<p>gene</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "createdAt": 1372712111, "updatedAt": 1372712111, "id": "26447771", "ancestorId": "26447746"}, "vis": 1, "type": 0, "event": 1372712111683578, "childContent": []}, {"source": 5, "content": {"parentId": "26447746", "bodyHtml": "<p>adslkjag</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "createdAt": 1372712105, "updatedAt": 1372712105, "id": "26447770", "ancestorId": "26447746"}, "vis": 1, "type": 0, "event": 1372712105685205, "childContent": []}, {"source": 5, "content": {"parentId": "26447746", "bodyHtml": "<p>ffsdf</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "createdAt": 1372712101, "updatedAt": 1372712101, "id": "26447769", "ancestorId": "26447746"}, "vis": 1, "type": 0, "event": 1372712101991395, "childContent": []}, {"source": 5, "content": {"parentId": "26447746", "bodyHtml": "<p>asdf 1372712029765</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "createdAt": 1372712030, "updatedAt": 1372712030, "id": "26447768", "ancestorId": "26447746"}, "vis": 1, "type": 0, "event": 1372712030297834, "childContent": []}, {"source": 5, "content": {"parentId": "26447746", "bodyHtml": "<p>asdf 1372711258543</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "createdAt": 1372711258, "updatedAt": 1372711258, "id": "26447763", "ancestorId": "26447746"}, "vis": 1, "type": 0, "event": 1372711259128446, "childContent": []}, {"source": 5, "content": {"parentId": "26447746", "bodyHtml": "<p>asdf</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "createdAt": 1372703336, "updatedAt": 1372703336, "id": "26447747", "ancestorId": "26447746"}, "vis": 1, "type": 0, "event": 1372703337262164, "childContent": []}]}, {"source": 5, "content": {"parentId": "", "bodyHtml": "<p>0 1372703328752</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "updatedAt": 1372703329, "id": "26447744", "createdAt": 1372703329}, "vis": 1, "type": 0, "event": 1372703329822076, "childContent": [{"source": 5, "content": {"parentId": "26447744", "bodyHtml": "<p>asdf</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "createdAt": 1372703330, "updatedAt": 1372703330, "id": "26447745", "ancestorId": "26447744"}, "vis": 1, "type": 0, "event": 1372703331394509, "childContent": []}]}, {"source": 5, "content": {"parentId": "", "bodyHtml": "<p>0 1372703292931</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "updatedAt": 1372703293, "id": "26447742", "createdAt": 1372703293}, "vis": 1, "type": 0, "event": 1372703293900419, "childContent": [{"source": 5, "content": {"parentId": "26447742", "bodyHtml": "<p>asdf</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "createdAt": 1372703295, "updatedAt": 1372703295, "id": "26447743", "ancestorId": "26447742"}, "vis": 1, "type": 0, "event": 1372703295859160, "childContent": []}]}, {"source": 5, "content": {"parentId": "", "bodyHtml": "<p>0 1372703283084</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "updatedAt": 1372703283, "id": "26447741", "createdAt": 1372703283}, "vis": 1, "type": 0, "event": 1372703284145888, "childContent": []}, {"source": 5, "content": {"parentId": "", "bodyHtml": "<p>0 1372703259644</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "updatedAt": 1372703259, "id": "26447739", "createdAt": 1372703259}, "vis": 1, "type": 0, "event": 1372703260597819, "childContent": [{"source": 5, "content": {"parentId": "26447739", "bodyHtml": "<p>asdf</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "createdAt": 1372703261, "updatedAt": 1372703261, "id": "26447740", "ancestorId": "26447739"}, "vis": 1, "type": 0, "event": 1372703262301630, "childContent": []}]}, {"source": 5, "content": {"parentId": "", "bodyHtml": "<p>2 1372702839981</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "updatedAt": 1372702841, "id": "26447737", "createdAt": 1372702841}, "vis": 1, "type": 0, "event": 1372702842456030, "childContent": [{"source": 5, "content": {"parentId": "26447737", "bodyHtml": "<p>vjhbv</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "createdAt": 1372713062, "updatedAt": 1372713062, "id": "26447775", "ancestorId": "26447737"}, "vis": 1, "type": 0, "event": 1372713063106834, "childContent": []}, {"source": 5, "content": {"parentId": "26447737", "bodyHtml": "<p>asdf 1372711139621</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "createdAt": 1372711139, "updatedAt": 1372711140, "id": "26447762", "ancestorId": "26447737"}, "vis": 1, "type": 0, "event": 1372711140372281, "childContent": []}, {"source": 5, "content": {"parentId": "26447737", "bodyHtml": "<p>asdf 1372709260088</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "createdAt": 1372709260, "updatedAt": 1372709260, "id": "26447753", "ancestorId": "26447737"}, "vis": 1, "type": 0, "event": 1372709260565058, "childContent": []}, {"source": 5, "content": {"parentId": "26447737", "bodyHtml": "<p>asdf</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "createdAt": 1372702843, "updatedAt": 1372702843, "id": "26447738", "ancestorId": "26447737"}, "vis": 1, "type": 0, "event": 1372702843797587, "childContent": []}]}, {"source": 5, "content": {"parentId": "", "bodyHtml": "<p>0 1372702682316</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "updatedAt": 1372702686, "id": "26447735", "createdAt": 1372702686}, "vis": 1, "type": 0, "event": 1372702686931099, "childContent": [{"source": 5, "content": {"parentId": "26447735", "bodyHtml": "<p>asdf</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "createdAt": 1372702688, "updatedAt": 1372702688, "id": "26447736", "ancestorId": "26447735"}, "vis": 1, "type": 0, "event": 1372702689041992, "childContent": []}]}, {"source": 5, "content": {"parentId": "", "bodyHtml": "<p>0 1372702303895</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "updatedAt": 1372702301, "id": "26447733", "createdAt": 1372702300}, "vis": 1, "type": 0, "event": 1372702301681285, "childContent": [{"source": 5, "content": {"parentId": "26447733", "bodyHtml": "<p>stream quickly pls</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "createdAt": 1372788991, "updatedAt": 1372788991, "id": "26447895", "ancestorId": "26447733"}, "vis": 1, "type": 0, "event": 1372788992101458, "childContent": []}, {"source": 5, "content": {"parentId": "26447733", "bodyHtml": "<p>bam! indeed</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "createdAt": 1372787751, "updatedAt": 1372787751, "id": "26447894", "ancestorId": "26447733"}, "vis": 1, "type": 0, "event": 1372787751910104, "childContent": []}, {"source": 5, "content": {"parentId": "26447733", "bodyHtml": "<p>asdfe333</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "createdAt": 1372787639, "updatedAt": 1372787639, "id": "26447893", "ancestorId": "26447733"}, "vis": 1, "type": 0, "event": 1372787639502487, "childContent": []}, {"source": 5, "content": {"parentId": "26447733", "bodyHtml": "<p>gaggaaa</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "createdAt": 1372787050, "updatedAt": 1372787050, "id": "26447892", "ancestorId": "26447733"}, "vis": 1, "type": 0, "event": 1372787050300324, "childContent": []}, {"source": 5, "content": {"parentId": "26447733", "bodyHtml": "<p>asldkfljasdf</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "createdAt": 1372786675, "updatedAt": 1372786675, "id": "26447891", "ancestorId": "26447733"}, "vis": 1, "type": 0, "event": 1372786675685834, "childContent": []}, {"source": 5, "content": {"parentId": "26447733", "bodyHtml": "<p>ace</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "createdAt": 1372786197, "updatedAt": 1372786197, "id": "26447890", "ancestorId": "26447733"}, "vis": 1, "type": 0, "event": 1372786197615157, "childContent": []}, {"source": 5, "content": {"parentId": "26447733", "bodyHtml": "<p>eeeerrrrrrrr</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "createdAt": 1372786130, "updatedAt": 1372786130, "id": "26447889", "ancestorId": "26447733"}, "vis": 1, "type": 0, "event": 1372786131003617, "childContent": []}, {"source": 5, "content": {"parentId": "26447733", "bodyHtml": "<p>asdfaseeeee</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "createdAt": 1372786033, "updatedAt": 1372786033, "id": "26447888", "ancestorId": "26447733"}, "vis": 1, "type": 0, "event": 1372786033899802, "childContent": []}, {"source": 5, "content": {"parentId": "26447733", "bodyHtml": "<p>testy</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "createdAt": 1372785971, "updatedAt": 1372785971, "id": "26447887", "ancestorId": "26447733"}, "vis": 1, "type": 0, "event": 1372785971576983, "childContent": []}, {"source": 5, "content": {"parentId": "26447733", "bodyHtml": "<p>once again</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "createdAt": 1372785899, "updatedAt": 1372785899, "id": "26447886", "ancestorId": "26447733"}, "vis": 1, "type": 0, "event": 1372785899797464, "childContent": []}, {"source": 5, "content": {"parentId": "26447733", "bodyHtml": "<p>yeah yeah</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "createdAt": 1372785788, "updatedAt": 1372785788, "id": "26447885", "ancestorId": "26447733"}, "vis": 1, "type": 0, "event": 1372785789117862, "childContent": []}, {"source": 5, "content": {"parentId": "26447733", "bodyHtml": "<p>gene gene gene 3</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "createdAt": 1372785766, "updatedAt": 1372785766, "id": "26447884", "ancestorId": "26447733"}, "vis": 1, "type": 0, "event": 1372785766672297, "childContent": []}, {"source": 5, "content": {"parentId": "26447733", "bodyHtml": "<p>gene gene gene</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "createdAt": 1372785754, "updatedAt": 1372785755, "id": "26447883", "ancestorId": "26447733"}, "vis": 1, "type": 0, "event": 1372785755360361, "childContent": []}, {"source": 5, "content": {"parentId": "26447733", "bodyHtml": "<p>no body</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "createdAt": 1372784376, "updatedAt": 1372784376, "id": "26447881", "ancestorId": "26447733"}, "vis": 1, "type": 0, "event": 1372784376320420, "childContent": []}, {"source": 5, "content": {"parentId": "26447733", "bodyHtml": "<p>asdfasdfasdf</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "createdAt": 1372783735, "updatedAt": 1372783735, "id": "26447878", "ancestorId": "26447733"}, "vis": 1, "type": 0, "event": 1372783735820433, "childContent": []}, {"source": 5, "content": {"parentId": "26447733", "bodyHtml": "<p>gssdf</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "createdAt": 1372783707, "updatedAt": 1372783708, "id": "26447876", "ancestorId": "26447733"}, "vis": 1, "type": 0, "event": 1372783708230680, "childContent": []}, {"source": 5, "content": {"parentId": "26447733", "bodyHtml": "<p>clothes again 2</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "createdAt": 1372783654, "updatedAt": 1372783654, "id": "26447875", "ancestorId": "26447733"}, "vis": 1, "type": 0, "event": 1372783654514543, "childContent": []}, {"source": 5, "content": {"parentId": "26447733", "bodyHtml": "<p>clothes again</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "createdAt": 1372783637, "updatedAt": 1372783637, "id": "26447874", "ancestorId": "26447733"}, "vis": 1, "type": 0, "event": 1372783638113650, "childContent": []}, {"source": 5, "content": {"parentId": "26447733", "bodyHtml": "<p>Oh. Shit.</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "createdAt": 1372724323, "updatedAt": 1372724323, "id": "26447794", "ancestorId": "26447733"}, "vis": 1, "type": 0, "event": 1372724323603019, "childContent": []}, {"source": 5, "content": {"parentId": "26447733", "bodyHtml": "<p>This is the shit.</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "createdAt": 1372714901, "updatedAt": 1372714901, "id": "26447787", "ancestorId": "26447733"}, "vis": 1, "type": 0, "event": 1372714901592472, "childContent": []}, {"source": 5, "content": {"parentId": "26447733", "bodyHtml": "<p>put it on ebay!!! pls</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "createdAt": 1372712599, "updatedAt": 1372712599, "id": "26447773", "ancestorId": "26447733"}, "vis": 1, "type": 0, "event": 1372712600154560, "childContent": []}, {"source": 5, "content": {"parentId": "26447733", "bodyHtml": "<p>asdf 1372710986926</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "createdAt": 1372710987, "updatedAt": 1372710987, "id": "26447761", "ancestorId": "26447733"}, "vis": 1, "type": 0, "event": 1372710987453705, "childContent": []}, {"source": 5, "content": {"parentId": "26447733", "bodyHtml": "<p>asdf 1372710963003</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "createdAt": 1372710963, "updatedAt": 1372710963, "id": "26447760", "ancestorId": "26447733"}, "vis": 1, "type": 0, "event": 1372710963568013, "childContent": []}, {"source": 5, "content": {"parentId": "26447733", "bodyHtml": "<p>asdf 1372710901267</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "createdAt": 1372710901, "updatedAt": 1372710901, "id": "26447759", "ancestorId": "26447733"}, "vis": 1, "type": 0, "event": 1372710901840190, "childContent": []}, {"source": 5, "content": {"parentId": "26447733", "bodyHtml": "<p>asdf 1372710848870</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "createdAt": 1372710849, "updatedAt": 1372710849, "id": "26447758", "ancestorId": "26447733"}, "vis": 1, "type": 0, "event": 1372710849309361, "childContent": []}, {"source": 5, "content": {"parentId": "26447733", "bodyHtml": "<p>asdf 1372710845069</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "createdAt": 1372710845, "updatedAt": 1372710845, "id": "26447757", "ancestorId": "26447733"}, "vis": 1, "type": 0, "event": 1372710845603555, "childContent": []}, {"source": 5, "content": {"parentId": "26447733", "bodyHtml": "<p>asdf 1372710773907</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "createdAt": 1372710774, "updatedAt": 1372710774, "id": "26447756", "ancestorId": "26447733"}, "vis": 1, "type": 0, "event": 1372710774458637, "childContent": []}, {"source": 5, "content": {"parentId": "26447733", "bodyHtml": "<p>asdf 1372710406493</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "createdAt": 1372710406, "updatedAt": 1372710406, "id": "26447754", "ancestorId": "26447733"}, "vis": 1, "type": 0, "event": 1372710407227233, "childContent": []}, {"source": 5, "content": {"parentId": "26447733", "bodyHtml": "<p>asdf 1372709251249</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "createdAt": 1372709251, "updatedAt": 1372709251, "id": "26447752", "ancestorId": "26447733"}, "vis": 1, "type": 0, "event": 1372709251698365, "childContent": []}, {"source": 5, "content": {"parentId": "26447733", "bodyHtml": "<p>asdf 1372709220760</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "createdAt": 1372709220, "updatedAt": 1372709221, "id": "26447751", "ancestorId": "26447733"}, "vis": 1, "type": 0, "event": 1372709221854376, "childContent": []}, {"source": 5, "content": {"parentId": "26447733", "bodyHtml": "<p>asdf 1372704197627</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "createdAt": 1372704197, "updatedAt": 1372704197, "id": "26447750", "ancestorId": "26447733"}, "vis": 1, "type": 0, "event": 1372704198684578, "childContent": []}, {"source": 5, "content": {"parentId": "26447733", "bodyHtml": "<p>asdf</p>", "annotations": {"moderator": true, "procurementmeta": [{"networkId": "labs-t402.fyre.co", "siteId": "303827", "collectionRuleId": "10712944@fyre.io", "collectionId": "10712944"}]}, "authorId": "system@labs-t402.fyre.co", "createdAt": 1372702302, "updatedAt": 1372702302, "id": "26447734", "ancestorId": "26447733"}, "vis": 1, "type": 0, "event": 1372702302898773, "childContent": []}]}], "authors": {"system@labs-t402.fyre.co": {"displayName": "system", "tags": [], "profileUrl": "", "avatar": "http://gravatar.com/avatar/e23293c6dfc25b86762b045336233add/?s=50&d=http://avatars-staging.fyre.co/a/anon/50.jpg", "type": 1, "id": "system@labs-t402.fyre.co"}}, "followers": ["system@labs-t402.fyre.co"], "isComplete": false}, "siteSettings": {"nestLevel": 4, "enabled": true, "__modified__": 1371506702.450499, "premoderated": false, "allowGuestComments": false}, "networkSettings": {"highVelocityMode": false, "mediaDisplay": 1, "allowEditComments": false, "richTextEnabled": true, "editCommentInterval": 5, "allowGuestComments": false, "liShareEnabled": false, "enabled": true, "fbShareEnabled": true, "hovercardsEnabled": true, "nestLevel": 4, "streamType": 1, "throttleStream": false, "repliesEnabled": true, "premoderated": false, "topContentDisplay": 1, "commentsEnabled": true, "charLimit": 8000, "twitterShareEnabled": true, "rawHtml": false, "__modified__": 1371779372.99041}, "collectionSettings": {"networkId": "labs-t402.fyre.co", "archiveInfo": {"nPages": 2, "pageInfo": {"1": {"url": "/t402.livefyre.com/labs-t402.fyre.co/303827/Y29udGV4dHVhbF8x/1.json", "last": 1372807378, "first": 1372777857}, "0": {"url": "/t402.livefyre.com/labs-t402.fyre.co/303827/Y29udGV4dHVhbF8x/0.json", "last": 1372704030, "first": 1372469583}}, "pathBase": "/t402.livefyre.com/labs-t402.fyre.co/303827/Y29udGV4dHVhbF8x/"}, "allowEditComments": false, "collectionId": "10712944", "url": "", "checksum": "", "bootstrapUrl": "/t402.livefyre.com/labs-t402.fyre.co/303827/Y29udGV4dHVhbF8x/head.json", "title": "", "numVisible": 114, "nestLevel": 0, "siteId": "303827", "commentsDisabled": false, "allowGuestComments": false, "followers": 1, "config": {"__modified__": 1372807410.134516}, "data": [], "event": 1372807378824134, "editCommentInterval": 0}};
        });

        describe("when constructed with a page and no initData", function () {
            beforeEach(function() {
                opts = {
                    "network": "labs-t402.fyre.co",
                    "siteId": "303827",
                    "articleId": "gene_publish_0",
                    "environment": "t402.livefyre.com",
                    "page": 4
                };
                spy = spyOn(LivefyreBootstrapClient, "getContent").andCallFake(function(opts, fn) {
                    fn(null, mockData);
                });

                stream = new LivefyreReverseStream(opts);
                stream._push = jasmine.createSpy();
                stream._endRead = jasmine.createSpy();
            });

            it ("should getContent() from LivefyreBootstrapClient when _read() is called", function () {
                stream._read();

                waitsFor(function() {
                    return stream._endRead.callCount > 0;
                });
                runs(function() {
                    expect(spy).toHaveBeenCalled();
                    expect(stream._endRead).toHaveBeenCalled();
                    expect(stream._endRead.callCount).toBe(1);
                    expect(stream._push).toHaveBeenCalled();
                    expect(stream._push.callCount).toBe(48);
                });
            });

            it ("should not emit content from states that are not visible", function () {
                var nonVisState = {
                    erefs: ["PF48kezy4YAeCjXtsYv379JcxaqFjgt1J0n89+ixAF26p+hMnmyimWdVuE6oofxWzXmoQYdFsBZ3+1IpUXEh+C5tPkcyZbDTRzYgPgU1ZN/0OdbNJpw="],
                    source: 1,
                    content: {
                        replaces: "",
                        id: "tweet-351026197783785472@twitter.com",
                        createdAt: 1372526142,
                        parentId: ""
                    },
                    vis: 2,
                    type: 0,
                    event: 1372526143230762,
                    childContent: []
                };

                mockData.content = [nonVisState];
                stream._read();

                waitsFor(function() {
                    return stream._endRead.callCount > 0;
                });
                runs(function() {
                    expect(stream._push.callCount).toBe(0);
                });
            });
        });

        describe("when constructed without a .page or .initData", function () {
            var stream;
            beforeEach(function () {
                stream = new LivefyreReverseStream({
                    "network": "labs-t402.fyre.co",
                    "siteId": "303827",
                    "articleId": "gene_publish_0",
                    "environment": "t402.livefyre.com"
                });
                spyOn(LivefyreBootstrapClient, 'getContent').andCallFake(function (opts, cb) {
                    cb(null, opts.page === null ? mockInitResponse : mockInitResponse.headDocument);
                });
                spyOn(stream, '_push').andCallThrough();
                spyOn(stream, '_setHeadDocument').andCallThrough();
            });
            describe('on first start', function () {
                beforeEach(function () {
                    stream.start();
                });
                it('requests bootstrap init', function () {
                    expect(LivefyreBootstrapClient.getContent.callCount).toBe(1);
                    expect(LivefyreBootstrapClient.getContent.mostRecentCall.args[0].page).toBe(null);
                });
                it('sets the headDocument', function () {
                    expect(stream._setHeadDocument).toHaveBeenCalledWith(mockInitResponse.headDocument);
                });
                it('sets .page', function () {
                    expect(stream.page).toBe("1");
                });
                describe("and on subsequent start", function () {
                    var pushCallCountBeforeSecondStart;
                    beforeEach(function () {
                        pushCallCountBeforeSecondStart = stream._push.callCount;
                        stream.start();
                    });
                    it("calls LivefyreBootstrapClient with a page", function () {
                        expect(LivefyreBootstrapClient.getContent.mostRecentCall.args[0].page).toBe('1');
                    });
                    it("does not ._push content that was already emitted from headDocument", function () {
                        // Because all requests to LivefyreBootstrapClient.getContent are returning the same response,
                        // The second start will return the same Content as in the headDocument, and nothing should be _pushed
                        expect(stream._push.callCount).toBe(pushCallCountBeforeSecondStart);
                    });
                });
            });
        });

        describe("when constructed with opts.initData", function () {
            var stream;
            beforeEach(function () {
                stream = new LivefyreReverseStream({
                    "network": "labs-t402.fyre.co",
                    "siteId": "303827",
                    "articleId": "gene_publish_0",
                    "environment": "t402.livefyre.com",
                    "initData": mockInitResponse
                });
            });
            it("should set ._headDocumentContentIds on construction", function () {
                expect(stream._headDocumentContentIds.length > 0).toBe(true);
            });
            describe("on first start", function () {
                beforeEach(function () {
                    spyOn(LivefyreBootstrapClient, "getContent").andCallFake(function(opts, fn) {
                        fn(null, mockInitResponse.headDocument);
                    });
                    spyOn(stream, '_push').andCallThrough();
                    spyOn(stream, '_endRead').andCallThrough();
                    stream.start();
                });
                it("should emit Content from headDocument on first start, and not use LivefyreBootstrapClient", function () {
                    expect(stream._pushedHeadDocument).toBe(true);
                    expect(LivefyreBootstrapClient.getContent).not.toHaveBeenCalled();
                    expect(stream._push).toHaveBeenCalled();
                });
                describe("and on subsequent start", function () {
                    var pushCallCountBeforeSecondStart;
                    beforeEach(function () {
                        pushCallCountBeforeSecondStart = stream._push.callCount;
                        stream.start();
                    });
                    it("calls LivefyreBootstrapClient for the first time", function () {
                        expect(LivefyreBootstrapClient.getContent.callCount).toBe(1);
                    });
                    it("does not ._push content that was already emitted from headDocument", function () {
                        // Because all requests to LivefyreBootstrapClient.getContent are returning the same response,
                        // The second start will return the same Content as in the headDocument, and nothing should be _pushed
                        expect(stream._push.callCount).toBe(pushCallCountBeforeSecondStart);
                    });
                });
            });
        });
		
		/**
		 * By default, this stream will not emit content that is in reply to another piece of Content.
		 * However, if the stream is constructed with opts.replies=true, then all reply Content will be emitted
		 */
		describe('replies', function () {
			var stateWithChildren,
				bootstrapResponse;
			/**
			 * Make a state object with the provided Content ID
			 */
			function makeState (id, parentId) {
				return {"source":0,"content":{"parentId": parentId || "","bodyHtml":"Yay!!!!!!!  Love being part of the <a vocab=\"http://schema.org\" typeof=\"Person\" rel=\"nofollow\" resource=\"acct:7025662\" data-lf-handle=\"\" data-lf-provider=\"twitter\" property=\"url\" href=\"https://twitter.com/#!/DrPhil\" target=\"_blank\" class=\"fyre-mention fyre-mention-twitter\">@<span property=\"name\">DrPhil</span></a> <a href=\"https://twitter.com/#!/search/realtime/%23cheaters\" class=\"fyre-hashtag\" hashtag=\"cheaters\" rel=\"tag\" target=\"_blank\">#cheaters</a> segment!!!!","annotations":{},"authorId":"24070923@twitter.com","updatedAt":1376328718,"id":String(id),"createdAt":1376328718},"vis":1,"type":0,"event":1376328743545495,"childContent":[]};
			}
			beforeEach(function () {
				// Top level
				stateWithChildren = makeState(1);
				// First level of replies
				stateWithChildren.childContent.push(makeState(2, 1));
				stateWithChildren.childContent.push(makeState(3, 1));
				// Second level of replies
				stateWithChildren.childContent[0].childContent.push(makeState(4, 2));
				bootstrapResponse = {
					content: [stateWithChildren],
					authors: {
						"24070923@twitter.com": {"displayName":"Anna Davenport","tags":[],"profileUrl":"https://twitter.com/#!/PrettyUnlimited","avatar":"http://a0.twimg.com/profile_images/3681462401/9ec2fff9c0f8ccaf8ea4bdc30e512fd0_normal.jpeg","type":3,"id":"24070923@twitter.com"}
					}
				}
				spyOn(LivefyreBootstrapClient, 'getContent').andCallFake(function (opts, errback) {
					errback(null, bootstrapResponse);
				});
			});
			it('does not emit reply Content by default', function () {
				var numTimesReadable = 0;
				var stream = new LivefyreReverseStream({
					"network": "labs-t402.fyre.co",
                    "siteId": "303827",
                    "articleId": "gene_publish_0",
                    "environment": "t402.livefyre.com"
				});
				stream.on('readable', function () {
					numTimesReadable++;
				});
				stream.start();
				waitsFor(function () {
					return LivefyreBootstrapClient.getContent.callCount > 0;
				});
				runs(function () {
					expect(numTimesReadable).toBe(1);
				});
			});
			describe('when constructed with opts.replies = true', function () {
				var stream;
				beforeEach(function () {
					stream = new LivefyreReverseStream({
						"network": "labs-t402.fyre.co",
	                    "siteId": "303827",
	                    "articleId": "gene_publish_0",
	                    "environment": "t402.livefyre.com",
	                    "replies": true
					});
				})
				it('emits reply Content, including replies of replies', function () {
					var numTimesReadable = 0;
					stream.on('readable', function () {
						numTimesReadable++;
					});
					stream.start();
					waitsFor(function () {
						return LivefyreBootstrapClient.getContent.callCount > 0;
					});
					runs(function () {
						expect(numTimesReadable).toBe(4);
					});
				});
			});
		});

        describe('when a plugin is added', function () {
            var stream,
                plugin,
                plaintextState = {"content":{"fields":{"body":{"type":"text/plain","value":"Some more text"},"type":{"type":null,"value":"text/plain"}},"updatedAt":1374182270,"createdAt":1374182270,"parentId":null,"id":"7095cb02-0902-4470-a8c5-f1d84a5b9fa1","ancestorId":null,"sortOrder":6.250000086552674e+22},"source":17,"type":4,"event":1374182270623258};
            beforeEach(function () {
                stream = new LivefyreReverseStream({});
                spyOn(LivefyreBootstrapClient, 'getContent').andCallFake(function (opts, cb) {
                    cb(null, {
                        content: [{fake: true, content: { id: '1', author: '1'}}]
                    });
                });
                plugin = jasmine.createSpy('stream plugin');
                stream.plugins.push(plugin);
            });
            it('has the plugin in .plugins', function () {
                expect(stream.plugins.indexOf(plugin)).not.toBe(-1);
            });
            it('tries to use the plugin to handle unknown states', function () {
                stream.start();
                expect(plugin).toHaveBeenCalled();
            });
            it('_pushes new content if the plugin returns something', function () {
                var result = {test: 1};
                spyOn(stream, '_push').andCallThrough();
                stream.plugins = [function () {
                    return result;
                }];
                stream.start();
                expect(stream._push).toHaveBeenCalledWith(result);
            });
            it('does not _push new content if the plugin returns falsy', function () {
                spyOn(stream, '_push').andCallThrough();
                stream.plugins = [function () {
                    return;
                }];
                stream.start();
                expect(stream._push).not.toHaveBeenCalled();
            });
            it('does not _push new content if the plugin throws', function () {
                spyOn(stream, '_push').andCallThrough();
                stream.plugins = [function () {
                    throw new Error();
                }];
                stream.start();
                expect(stream._push).not.toHaveBeenCalled();
            });
        });

    });
});